import { useRef, useEffect, useState } from "react"
import styled from "styled-components";
import { motion } from "framer-motion"

const InteractiveTab = styled(motion.svg)`
`

const Tab = ({correctNote, expectedNoteIndex , finished}) => {
  const svgRef = useRef(null)
  const [noteCircles, setNoteCircles] = useState([]);
  const [push, setPush] = useState(0)
  
  useEffect(() => {
    const circles = svgRef.current.querySelectorAll("circle")
    setNoteCircles(Array.from(circles))
  }, [setNoteCircles])
  
  useEffect(() => {
    if (correctNote === true && expectedNoteIndex >= 1 && expectedNoteIndex <= noteCircles.length) {
      const playedIndex = expectedNoteIndex - 1
      const updatedCircles = [...noteCircles]
      updatedCircles[playedIndex].style.fill = "green"
      const noteDistance = updatedCircles[playedIndex].cx.baseVal.value - updatedCircles[expectedNoteIndex].cx.baseVal.value
      setNoteCircles(updatedCircles)
      setPush(prevPush => prevPush - noteDistance)
    }
  }, [correctNote, expectedNoteIndex, noteCircles, setNoteCircles, setPush])

  
  const variants = {
    finished: {x: `-${push}px`, transition:{duration: 0.5, ease: "easeOut"}}, 
    notFinished: {x: "0%"}
  }
  

  return (
    <InteractiveTab
      viewBox="0 0 3540 295"
      xmlns="http://www.w3.org/2000/svg"
      width={3540}
      height={295}
      fill="none"
      ref={svgRef}
      animate={finished ? "finished" : "notFinished"} 
      transition={{duration: 60, ease: "linear"}}
      variants={variants}
    >
      <path fill="#EDEDED" d="M38 1h3496v291H38z" />
      <mask id="a" fill="#fff">
        <path d="M563 3h175v288H563V3Z" />
      </mask>
      <path fill="#D9D9D9" d="M734 3v288h8V3h-8Z" mask="url(#a)" />
      <mask id="b" fill="#fff">
        <path d="M1263 3h175v288h-175V3Z" />
      </mask>
      <path fill="#D9D9D9" d="M1434 3v288h8V3h-8Z" mask="url(#b)" />
      <mask id="c" fill="#fff">
        <path d="M1963 3h175v288h-175V3Z" />
      </mask>
      <path fill="#D9D9D9" d="M2134 3v288h8V3h-8Z" mask="url(#c)" />
      <mask id="d" fill="#fff">
        <path d="M2663 3h175v288h-175V3Z" />
      </mask>
      <path fill="#D9D9D9" d="M2834 3v288h8V3h-8Z" mask="url(#d)" />
      <path stroke="#9E9E9E" strokeWidth={6} d="M36 256h3498" />
      <path stroke="#9E9E9E" strokeWidth={5} d="M36 212h3498" />
      <path stroke="#9E9E9E" strokeWidth={4} d="M36 168h3498" />
      <path stroke="#9E9E9E" strokeWidth={3} d="M36 124h3498" />
      <path stroke="#9E9E9E" strokeWidth={2} d="M36 80h3498" />
      <path stroke="#9E9E9E" d="M36 36h3498" />
      <path
        fill="#000"
        d="M8.336 41.265c-1.227 0-2.286-.27-3.176-.812-.884-.547-1.566-1.31-2.047-2.288-.476-.984-.713-2.128-.713-3.433 0-1.304.237-2.454.713-3.449.48-1 1.15-1.78 2.006-2.338.862-.563 1.868-.845 3.018-.845.663 0 1.318.11 1.965.331a4.87 4.87 0 0 1 1.766 1.078c.53.492.953 1.144 1.268 1.957.315.812.473 1.813.473 3.001v.829H3.793v-1.691h7.826c0-.719-.144-1.36-.431-1.924a3.248 3.248 0 0 0-1.21-1.335c-.52-.326-1.134-.489-1.841-.489-.78 0-1.454.194-2.023.58a3.817 3.817 0 0 0-1.302 1.493 4.384 4.384 0 0 0-.456 1.973v1.128c0 .962.166 1.777.498 2.446.337.663.804 1.169 1.4 1.517.598.342 1.291.514 2.082.514.514 0 .978-.072 1.393-.216.42-.15.782-.37 1.086-.663.304-.299.539-.669.704-1.111l1.89.53a4.19 4.19 0 0 1-1.003 1.692 4.89 4.89 0 0 1-1.74 1.127c-.691.266-1.468.398-2.33.398ZM2.464 86V69.02H8.4c1.183 0 2.158.205 2.927.614.768.404 1.34.948 1.716 1.634.376.68.564 1.434.564 2.263 0 .73-.13 1.332-.39 1.807a3.032 3.032 0 0 1-1.012 1.128c-.414.276-.865.48-1.351.613v.166c.52.033 1.042.216 1.567.547.525.332.965.807 1.318 1.426.354.62.53 1.376.53 2.272 0 .851-.193 1.617-.58 2.296-.386.68-.997 1.22-1.832 1.617-.834.398-1.92.597-3.258.597H2.464Zm2.056-1.824h4.079c1.343 0 2.296-.26 2.86-.78.57-.524.854-1.16.854-1.906a3.03 3.03 0 0 0-.44-1.592 3.18 3.18 0 0 0-1.251-1.177c-.542-.299-1.183-.448-1.924-.448H4.52v5.903Zm0-7.694h3.814c.619 0 1.177-.121 1.674-.364.503-.244.901-.586 1.194-1.028.299-.443.448-.962.448-1.56 0-.745-.26-1.378-.78-1.898-.519-.525-1.342-.787-2.47-.787H4.52v5.637ZM12.988 118.327a5.994 5.994 0 0 0-.721-1.501 4.626 4.626 0 0 0-1.053-1.144 4.424 4.424 0 0 0-1.377-.721 5.478 5.478 0 0 0-1.69-.249c-1.007 0-1.922.26-2.745.779-.824.52-1.479 1.285-1.965 2.297-.486 1.011-.73 2.252-.73 3.722 0 1.471.246 2.711.738 3.723.492 1.011 1.158 1.777 1.998 2.296.84.52 1.786.78 2.836.78.973 0 1.83-.208 2.57-.622a4.414 4.414 0 0 0 1.74-1.774c.421-.769.631-1.672.631-2.711l.63.132H8.743v-1.824h6.467v1.824c0 1.399-.299 2.615-.896 3.648a6.18 6.18 0 0 1-2.454 2.404c-1.039.564-2.233.846-3.581.846-1.504 0-2.825-.354-3.963-1.061-1.133-.708-2.018-1.713-2.653-3.018-.63-1.304-.945-2.852-.945-4.643 0-1.343.18-2.55.539-3.623.364-1.077.878-1.995 1.542-2.752a6.74 6.74 0 0 1 2.354-1.741c.907-.404 1.904-.605 2.993-.605.896 0 1.73.135 2.504.406a6.71 6.71 0 0 1 2.08 1.136 6.457 6.457 0 0 1 1.535 1.749 6.66 6.66 0 0 1 .845 2.247h-2.122ZM6.906 174h-5.24v-16.979h5.472c1.647 0 3.056.34 4.228 1.02 1.172.674 2.07 1.644 2.694 2.91.625 1.26.937 2.769.937 4.526 0 1.769-.315 3.292-.945 4.568-.63 1.272-1.547 2.25-2.752 2.935-1.205.68-2.67 1.02-4.394 1.02Zm-3.184-1.824h3.051c1.404 0 2.567-.271 3.49-.812a5.008 5.008 0 0 0 2.065-2.314c.453-1 .68-2.191.68-3.573 0-1.37-.224-2.551-.672-3.54-.448-.995-1.117-1.757-2.006-2.288-.89-.536-1.998-.804-3.325-.804H3.722v13.331ZM2.864 218H.708l6.235-16.979h2.122L15.3 218h-2.156L8.07 203.707h-.132L2.864 218Zm.796-6.633h8.688v1.824H3.66v-1.824ZM3.08 262v-16.979h10.247v1.824H5.136v5.737h7.66v1.824h-7.66v5.77h8.323V262H3.08Z"
      />
      <path
        fill="#000"
        fillRule="evenodd"
        d="M32 0v295h3508V0H32Zm3502 6H38v283h3496V6Z"
        clipRule="evenodd"
      />
      <circle cx={298.5} cy={255.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M298.471 261.159c-.849 0-1.604-.146-2.267-.437-.659-.296-1.18-.701-1.563-1.216a3.06 3.06 0 0 1-.585-1.796h2.477c.016.284.108.534.279.75.174.212.405.377.693.495.288.117.612.176.972.176.375 0 .706-.067.994-.199.288-.133.513-.316.676-.551a1.39 1.39 0 0 0 .244-.813c0-.31-.087-.585-.261-.824a1.669 1.669 0 0 0-.739-.568c-.318-.136-.697-.204-1.136-.204h-1.085v-1.807h1.085c.371 0 .699-.065.983-.193.288-.129.511-.307.67-.534.159-.232.239-.5.239-.807 0-.292-.07-.548-.21-.767a1.39 1.39 0 0 0-.58-.523 1.882 1.882 0 0 0-.863-.188c-.334 0-.639.061-.915.182a1.602 1.602 0 0 0-.665.506c-.167.22-.256.477-.267.773h-2.358a3.028 3.028 0 0 1 .574-1.773c.371-.511.871-.911 1.5-1.199.633-.292 1.347-.437 2.142-.437.803 0 1.506.145 2.108.437.602.292 1.07.686 1.403 1.182.337.492.504 1.045.5 1.659.004.651-.199 1.195-.608 1.631-.405.435-.933.712-1.585.829v.091c.856.11 1.508.407 1.955.892.45.481.674 1.083.67 1.807a2.833 2.833 0 0 1-.574 1.767c-.382.515-.911.92-1.585 1.216-.674.295-1.447.443-2.318.443Z"
      />
      <circle cx={460.5} cy={211.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M456.404 217v-1.773l4.142-3.835c.352-.341.648-.648.887-.92.242-.273.426-.54.551-.802.125-.265.187-.551.187-.858 0-.34-.077-.634-.233-.88a1.53 1.53 0 0 0-.636-.574 2 2 0 0 0-.915-.205c-.356 0-.667.072-.932.216a1.49 1.49 0 0 0-.613.62c-.144.269-.216.589-.216.96h-2.336c0-.762.173-1.422.518-1.983a3.446 3.446 0 0 1 1.448-1.301c.622-.307 1.338-.46 2.148-.46.833 0 1.559.147 2.176.443.621.291 1.104.697 1.449 1.216s.517 1.113.517 1.784c0 .439-.087.873-.261 1.301-.171.428-.476.903-.915 1.426-.439.519-1.059 1.142-1.858 1.869l-1.699 1.665v.08h4.887V217h-8.296Z"
      />
      <circle cx={622.5} cy={35.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M622.471 41.16c-.849 0-1.604-.147-2.267-.438-.659-.296-1.18-.701-1.563-1.216a3.059 3.059 0 0 1-.585-1.796h2.477c.016.284.108.534.279.75.174.212.405.377.693.495.288.117.612.176.972.176.375 0 .706-.067.994-.2.288-.132.513-.316.676-.55a1.39 1.39 0 0 0 .244-.813c0-.31-.087-.585-.261-.824-.17-.242-.417-.431-.739-.568-.318-.136-.697-.204-1.136-.204h-1.085v-1.807h1.085c.371 0 .699-.065.983-.193.288-.13.511-.307.67-.535.159-.23.239-.5.239-.806a1.396 1.396 0 0 0-.79-1.29 1.882 1.882 0 0 0-.863-.188c-.334 0-.639.061-.915.182a1.6 1.6 0 0 0-.665.506c-.167.22-.256.477-.267.773h-2.358c.011-.67.203-1.262.574-1.773.371-.512.871-.911 1.5-1.199.633-.292 1.347-.438 2.142-.438.803 0 1.506.146 2.108.438.602.292 1.07.686 1.403 1.182.337.492.504 1.045.5 1.659.004.652-.199 1.195-.608 1.63-.405.436-.933.713-1.585.83v.091c.856.11 1.508.407 1.955.892.45.481.674 1.084.67 1.807a2.834 2.834 0 0 1-.574 1.767c-.382.515-.911.92-1.585 1.216-.674.295-1.447.443-2.318.443Z"
      />
      <circle cx={866.5} cy={79.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M868.592 73.364V85h-2.461v-9.301h-.068l-2.665 1.67v-2.181l2.881-1.824h2.313Z"
      />
      <circle cx={1028.5} cy={167.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M1024.4 173v-1.773l4.15-3.835c.35-.341.64-.648.88-.92.24-.273.43-.54.55-.802.13-.265.19-.551.19-.858 0-.34-.08-.634-.23-.88-.16-.25-.37-.441-.64-.574a1.985 1.985 0 0 0-.91-.205c-.36 0-.67.072-.93.216-.27.144-.47.351-.62.62-.14.269-.21.589-.21.96h-2.34c0-.762.17-1.422.52-1.983.34-.561.83-.994 1.45-1.301.62-.307 1.33-.46 2.14-.46.84 0 1.56.147 2.18.443.62.291 1.1.697 1.45 1.216.34.519.52 1.113.52 1.784 0 .439-.09.873-.27 1.301-.17.428-.47.903-.91 1.426-.44.519-1.06 1.142-1.86 1.869l-1.7 1.665v.08h4.89V173h-8.3Z"
      />
      <circle cx={1190.5} cy={211.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M1190.47 217.159c-.85 0-1.6-.146-2.27-.437-.66-.296-1.18-.701-1.56-1.216-.38-.519-.57-1.118-.58-1.796h2.47c.02.284.11.534.28.75.18.212.41.377.69.495.29.117.62.176.98.176.37 0 .7-.067.99-.199.29-.133.51-.316.68-.551.16-.235.24-.506.24-.813 0-.31-.09-.585-.26-.824-.17-.242-.42-.432-.74-.568-.32-.136-.7-.204-1.14-.204h-1.08v-1.807h1.08c.38 0 .7-.065.99-.193.29-.129.51-.307.67-.534.16-.232.24-.5.24-.807 0-.292-.07-.548-.21-.767a1.409 1.409 0 0 0-.58-.523 1.921 1.921 0 0 0-.87-.188c-.33 0-.63.061-.91.182-.28.118-.5.286-.67.506-.16.22-.25.477-.26.773h-2.36c.01-.671.2-1.262.57-1.773.37-.511.87-.911 1.5-1.199.64-.292 1.35-.437 2.14-.437.81 0 1.51.145 2.11.437a3.48 3.48 0 0 1 1.41 1.182c.33.492.5 1.045.5 1.659 0 .651-.2 1.195-.61 1.631-.41.435-.94.712-1.59.829v.091c.86.11 1.51.407 1.96.892.45.481.67 1.083.67 1.807 0 .663-.19 1.252-.58 1.767-.38.515-.91.92-1.58 1.216-.68.295-1.45.443-2.32.443Z"
      />
      <circle cx={1533.5} cy={79.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M1535.59 73.364V85h-2.46v-9.301h-.07l-2.66 1.67v-2.181l2.88-1.824h2.31Z"
      />
      <circle cx={1695.5} cy={123.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M1691.4 129v-1.773l4.15-3.835c.35-.341.64-.648.88-.92.24-.273.43-.54.55-.802.13-.265.19-.551.19-.858 0-.34-.08-.634-.23-.88-.16-.25-.37-.441-.64-.574a1.985 1.985 0 0 0-.91-.205c-.36 0-.67.072-.93.216-.27.144-.47.351-.62.62-.14.269-.21.589-.21.96h-2.34c0-.762.17-1.422.52-1.983.34-.561.83-.994 1.45-1.301.62-.307 1.33-.46 2.14-.46.84 0 1.56.147 2.18.443.62.291 1.1.697 1.45 1.216.34.519.52 1.113.52 1.784 0 .439-.09.873-.27 1.301-.17.428-.47.903-.91 1.426-.44.519-1.06 1.142-1.86 1.869l-1.7 1.665v.08h4.89V129h-8.3Z"
      />
      <circle cx={1856.5} cy={167.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M1852.4 173v-1.773l4.15-3.835c.35-.341.64-.648.88-.92.24-.273.43-.54.55-.802.13-.265.19-.551.19-.858 0-.34-.08-.634-.23-.88-.16-.25-.37-.441-.64-.574a1.985 1.985 0 0 0-.91-.205c-.36 0-.67.072-.93.216-.27.144-.47.351-.62.62-.14.269-.21.589-.21.96h-2.34c0-.762.17-1.422.52-1.983.34-.561.83-.994 1.45-1.301.62-.307 1.33-.46 2.14-.46.84 0 1.56.147 2.18.443.62.291 1.1.697 1.45 1.216.34.519.52 1.113.52 1.784 0 .439-.09.873-.27 1.301-.17.428-.47.903-.91 1.426-.44.519-1.06 1.142-1.86 1.869l-1.7 1.665v.08h4.89V173h-8.3Z"
      />
      <circle cx={2298.5} cy={123.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M2294.4 129v-1.773l4.15-3.835c.35-.341.64-.648.88-.92.24-.273.43-.54.55-.802.13-.265.19-.551.19-.858 0-.34-.08-.634-.23-.88-.16-.25-.37-.441-.64-.574a1.985 1.985 0 0 0-.91-.205c-.36 0-.67.072-.93.216-.27.144-.47.351-.62.62-.14.269-.21.589-.21.96h-2.34c0-.762.17-1.422.52-1.983.34-.561.83-.994 1.45-1.301.62-.307 1.33-.46 2.14-.46.84 0 1.56.147 2.18.443.62.291 1.1.697 1.45 1.216.34.519.52 1.113.52 1.784 0 .439-.09.873-.27 1.301-.17.428-.47.903-.91 1.426-.44.519-1.06 1.142-1.86 1.869l-1.7 1.665v.08h4.89V129h-8.3Z"
      />
      <circle cx={2460.5} cy={79.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M2460.47 85.16c-.85 0-1.6-.147-2.27-.438-.66-.296-1.18-.701-1.56-1.216-.38-.52-.57-1.118-.58-1.796h2.47c.02.284.11.534.28.75.18.212.41.377.69.495.29.117.62.176.98.176.37 0 .7-.067.99-.2.29-.132.51-.316.68-.55.16-.235.24-.506.24-.813 0-.31-.09-.585-.26-.824-.17-.242-.42-.431-.74-.568-.32-.136-.7-.204-1.14-.204h-1.08v-1.807h1.08c.38 0 .7-.065.99-.193.29-.13.51-.307.67-.534.16-.232.24-.5.24-.807a1.396 1.396 0 0 0-.79-1.29 1.921 1.921 0 0 0-.87-.188c-.33 0-.63.061-.91.182-.28.118-.5.286-.67.506-.16.22-.25.477-.26.773h-2.36c.01-.67.2-1.262.57-1.773.37-.511.87-.911 1.5-1.199.64-.292 1.35-.438 2.14-.438.81 0 1.51.146 2.11.438.61.292 1.07.686 1.41 1.182.33.492.5 1.045.5 1.659 0 .651-.2 1.195-.61 1.63-.41.436-.94.713-1.59.83v.091c.86.11 1.51.407 1.96.892.45.481.67 1.084.67 1.807 0 .663-.19 1.252-.58 1.767-.38.515-.91.92-1.58 1.216-.68.295-1.45.443-2.32.443Z"
      />
      <circle cx={2622.5} cy={35.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M2618.4 41v-1.773l4.15-3.835c.35-.34.64-.648.88-.92.24-.273.43-.54.55-.802.13-.265.19-.55.19-.858 0-.34-.08-.634-.23-.88a1.56 1.56 0 0 0-.64-.574 1.98 1.98 0 0 0-.91-.205c-.36 0-.67.072-.93.216-.27.144-.47.35-.62.62-.14.269-.21.589-.21.96h-2.34c0-.761.17-1.422.52-1.983.34-.56.83-.994 1.45-1.301.62-.307 1.33-.46 2.14-.46.84 0 1.56.147 2.18.443.62.291 1.1.697 1.45 1.216.34.519.52 1.113.52 1.784 0 .44-.09.873-.27 1.3-.17.429-.47.904-.91 1.427-.44.519-1.06 1.142-1.86 1.87l-1.7 1.664v.08h4.89V41h-8.3Z"
      />
      <circle cx={2894.5} cy={123.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M2896.59 117.364V129h-2.46v-9.301h-.07l-2.66 1.67v-2.181l2.88-1.824h2.31Z"
      />
      <circle cx={3056.5} cy={168.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M3052.4 174v-1.773l4.15-3.835c.35-.341.64-.648.88-.92.24-.273.43-.54.55-.802.13-.265.19-.551.19-.858 0-.34-.08-.634-.23-.88-.16-.25-.37-.441-.64-.574a1.985 1.985 0 0 0-.91-.205c-.36 0-.67.072-.93.216-.27.144-.47.351-.62.62-.14.269-.21.589-.21.96h-2.34c0-.762.17-1.422.52-1.983.34-.561.83-.994 1.45-1.301.62-.307 1.33-.46 2.14-.46.84 0 1.56.147 2.18.443.62.291 1.1.697 1.45 1.216.34.519.52 1.113.52 1.784 0 .439-.09.873-.27 1.301-.17.428-.47.903-.91 1.426-.44.519-1.06 1.142-1.86 1.869l-1.7 1.665v.08h4.89V174h-8.3Z"
      />
      <circle cx={3218.5} cy={211.5} r={14.5} fill="#898989" />
      <path
        fill="#fff"
        d="M3214.4 217v-1.773l4.15-3.835c.35-.341.64-.648.88-.92.24-.273.43-.54.55-.802.13-.265.19-.551.19-.858 0-.34-.08-.634-.23-.88-.16-.25-.37-.441-.64-.574a1.985 1.985 0 0 0-.91-.205c-.36 0-.67.072-.93.216-.27.144-.47.351-.62.62-.14.269-.21.589-.21.96h-2.34c0-.762.17-1.422.52-1.983.34-.561.83-.994 1.45-1.301.62-.307 1.33-.46 2.14-.46.84 0 1.56.147 2.18.443.62.291 1.1.697 1.45 1.216.34.519.52 1.113.52 1.784 0 .439-.09.873-.27 1.301-.17.428-.47.903-.91 1.426-.44.519-1.06 1.142-1.86 1.869l-1.7 1.665v.08h4.89V217h-8.3Z"
      />
    </InteractiveTab>
  )}
  export default Tab
  